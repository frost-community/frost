# 技術スタック
- 言語: TypeScript(Node.js)
- フレームワーク: express.js
- 認可: 未定
- トークン認証: Passport (passport-http-bearer)
- データベース: PostgreSQL
- データベースアクセス: node-postgres + Dizzle
- テンプレートエンジン: EJS

# 主なアーキテクチャ

## 1. HTTPルーター
HTTPリクエストとサービスを仲介します。

HTTPルーターは、リクエストからパラメータやアクセスユーザーの情報を取り出し、\
そのままサービスに渡します。

トークン認証や権限チェックもここで行います。\
トークンのスコープ外となる操作はこの層で拒否されます。

## 2. サービス
ビジネスロジックを担当します。\
ユーザーから渡されたパラメータのチェック処理を含みます。\
DBへアクセスしたい場合はリポジトリを操作します。

### アプリケーションエラーと例外
Service内では「アプリケーションエラー」と「例外」と呼ぶ2種類のエラーが発生し得ます。

#### アプリケーションエラー
サービス側が規定したエラーです。主にAPI利用者に表示すべきエラーが含まれます。\
指定するパラメータが不足しているなど、APIの利用方法に問題がある場合などに発生します。

#### 例外
サーバー内部で発生したエラーを指します。\
こちらはアプリケーションエラーを除く全てのエラーが含まれます。\
例: データベースの制約に違反するデータを挿入しようとした時に発生するエラー\
サーバーのチェック処理の不足などによっても発生する可能性があります。

## 3. リポジトリ
DBにアクセスする部分を担当します。\
リポジトリはサービスからのみ操作されます。

リポジトリではアプリケーションエラーを発生させません。\
発生し得るエラーは全てサービス側でチェックしておく必要があります。\
やむを得ず発生したエラーは例外として扱われるか、失敗(呼び出し結果なし)として扱われます。

# その他
## entitiesディレクトリ
APIが返すオブジェクトの型を定義します。\
この型はデータベースのカラム構成と一致するとは限りません。
